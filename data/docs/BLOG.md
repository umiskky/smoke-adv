## PROBLEMS
- [ ] 渲染质量高，会出现渲染缺失问题；渲染质量低，出现纹理贴图多个像素点对应渲染的一个像素
- [ ] 单一场景位置选择，手动或自动
- [ ] 多场景光照参数，摄像机参数适配

## TODO LIST
- LOGGER
  - [x] 增加日志记录，接入comet.ml
- LOSS
  - [ ] 3D人物模型置信度2D-CP定位
  - [x] 3D人物模型置信度2D-GT定位
  - [ ] 3D人物模型置信度3D-GT定位
- BATCH DESIGN
  - [ ] 3D人物模型多角度渲染攻击
  - [ ] 3D人物模型多位置渲染攻击
  - [ ] 3D人物模型多场景渲染攻击
- MULTI-RESOLUTION STICKER DESIGN

## 2022-03-19
1. 渲染过程：
   1. 加载模型：
      1. 对于一个obj，内部存储了顶点数据（顶点坐标，顶点纹理坐标，顶点法线），面信息（顶点索引/纹理索引/法线索引 * 3 or 4）。
      2. pytorch3d 不导入顶点法线坐标，而是在需要时根据分割的三角形面元重新计算顶点法线。
   2. 坐标变换
   3. 光栅化：
      1. 对于每个像素，计算top k个面索引，重心坐标，zbuf，2D欧几里得距离
      2. 使用Soft-Rasterizer进行光栅化，计算概率图，==这里还没有具体了解，在CUDA上进行，输出为Fragments==
   4. 着色器：
      1. 使用phong着色法，利用面元顶点法线计算每个像素的法线，应用光照后，得到最后的color_map。
      2. blend使用soft方法，考虑到多个面和概率图？
2. 纹理贴图与最终渲染结果受到光栅化和着色器影响，光栅化受到物体位置、大小等因素决定，着色器渲染最后的颜色与光照、法线和贴图插值共同决定，想要从原理上解决纹理贴图和渲染图像不匹配比较难。
3. 为什么要匹配？大概是想要考虑物理域攻击，这里缺乏相关衣物纹理打印的调研，所以。。。。
4. ==留个记录：==考虑改变扰动的方式，可以改变扰动的分辨率，参考渲染图像的分辨率大小，先做一个比较小的扰动patch，缩放到高分辨率，可能涉及nearest、双线性插值、超分辨率等等，具体实现的时候再说，这里留个记录。
5. 实现多场景、多位置、多角度：
   1. 多角度最简单，具体涉及到怎么选择角度分布，是使用随机数采样分布，还是固定角度；角度分布的密度，怎么设计比较合适？
   2. 多位置稍微复杂了一点，针对一个场景，如何获得场景中合理的模型放置位置？方案一：手动放置，最简单，但是也最麻烦，不能实现过多的场景和位置；方案二：
   3. 多场景最为复杂。首先如何选择场景，场景包含对象种类、数量；场景的时间、天气；场景表示的语义信息，如转弯、停止等红绿灯。场景位置选择，小道，十字路口，高速路、城市道路等等。其次，怎么在waymo数据集中获得片段语义信息。目前pytorch3d是不能够渲染影子的，有影子的数据集片段是不能够使用的，慎重选择。
   4. 最后，还需要将代码修改成批处理形式，优化攻击流水线设计。
6. ==留个记录：==整个上衣或裤子的攻击可能还有问题，考虑到人不可能站在那让你检测，移动的时候，有些区域会出现褶皱什么的，不过暂时也不考虑。
7. ==留个记录：==实现多帧的攻击？好像暂时不用，因为smoke模型本质还是利用单帧信息，未来攻击其他模型可能会考虑到。